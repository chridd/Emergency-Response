<html>
<head>
    <link rel="stylesheet" type="text/css" href="web/css/mockup2.css">
    <script type="text/javascript" src="web/js/jquery.js"></script>
</head>
<body>

    <div id="wrapper">
        <div id="container">
            <div class="move col" id="left">Left</div>
            <div class="move col" id="right">Right</div>
            <div class="move row" id="forward">Forward</div>
            <div class="move row" id="back">Back</div>
        </div>
        <div id="map">
            <div class="row">
                <div class="col active"></div>
                <div class="col blank"></div>
                <div class="col blank"></div>
                <div class="col blank"></div>
            </div>
            <div class="row">
                <div class="col active"></div>
                <div class="col active"></div>
                <div class="col active"></div>
                <div class="col active"></div>
            </div>

        </div>
    </div>


    <script type="text/javascript">
        $(function() {

            var curPos = 'A';
            var curDir = 'north';
            var dirArray = [ 'north', 'west', 'south', 'east' ];

             var moves = {
                'A' : {
                    'north': 'B', 
                    'west': null, 
                    'south': null, 
                    'east': 'C',
                },
                'B' : {
                    'north': null, 
                    'west': null, 
                    'south': 'A', 
                    'east': null,
                },
                'C': {
                    'north': null, 
                    'west': 'A', 
                    'south': null, 
                    'east': 'D',
                },
                'D': {
                    'north': null, 
                    'west': 'C', 
                    'south': null, 
                    'east': 'E',
                },
                'E': {
                    'north': null, 
                    'west': 'D', 
                    'south': null, 
                    'east': null,
                },
             };
            // Turning left
            $('#left').on('click', function() {
                i = dirArray.indexOf(curDir);
                curDir = dirArray[ (i + 1) % 4];
                updateBackground()
                checkForwardButtonDisable();
            })
            // Turning Right
            $('#right').on('click', function() {
                i = dirArray.indexOf(curDir);
                if (i == 0) {
                    i = 3;
                } else {
                    i = i-1;
                }
                curDir = dirArray[i];
                updateBackground()  
                checkForwardButtonDisable();
            })
            // Turning Around (Back)
            $('#back').on('click', function() {
                i = dirArray.indexOf(curDir);
                curDir = dirArray[ (i + 2) % 4];
                updateBackground()  
                checkForwardButtonDisable();
            })

            $('#forward').on('click', function() {
                    m = moves[curPos];
                    if (m == null) {
                        return;
                    }
                    i = m[curDir];
                    if (i != null) {
                        curPos = i;
                        updateBackground()
                        checkForwardButtonDisable();
                    }
            })

            function getRightDir() {
                return dirArray[getRightDirIndex()];
            }
            function getLeftDir() {
                return dirArray[getLeftDirIndex()];
            }
            function getRightDirIndex() {
                if (i == 0) {
                    return 3;
                }
                return i-1;
            }
            function getLeftDirIndex() {
                return (i + 2) % 4
            }

            function updateBackground() {
                $('#container').css('background-image', 'url(web/img/'+curPos+'-'+curDir+'.jpg)');
            }

            function checkForwardButtonDisable() {
               m = moves[curPos];
               if (m != null) {
                   if (m[curDir] == null) {
                        $('#forward').hide('fast');
                        return;
                   }
                }
                $('#forward').show('fast');
            }

        });
        
    </script>
</body>
</html>