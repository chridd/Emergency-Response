<html>
<head>
    <!-- <link rel="stylesheet" type="text/css" href="web/css/demo01.css"> -->
    <script type="text/javascript" src="web/js/prototype.js"></script>
    <script type="text/javascript" src="web/js/jquery.js"></script>
    <script type="text/javascript">
        var $j = jQuery.noConflict()
    </script>
</head>
<body>
    <div id="create-container">
        <select name="floor" id="floor-selector" disabled>
            <option value="blank">No Floors Listed</option>
        </select>
        <select name="room" id="room-selector" disabled>
            <option value="blank">No Rooms Listed</option>
        </select>
        <select name="wall" id="wall-selector" disabled>
            <option value="blank">No Walls Listed</option>
        </select>
    </div>
        <textarea id="output" style="border: 1px solid black; width: 100%; height: 400px;">
            Info will display here....
        </textarea>
        <input type="submit" value="Display Info" id="getInfo" />


    <script type="text/javascript" src="web/js/demo01.js"></script>
    <script type="text/javascript" src="web/js/demo01-scenario.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function($){
            // init ui
            updateFloorSelector();


            // ##########################
            // ##### SELECT EVENTS ######
            // ##########################

            // User selects a floor from dropdown
            $('select#floor-selector').change(function() {
                if ($(this).attr('disabled')) {
                    console.log('Invalid change - Floor Selector changed while disabled')
                    return;
                }
                selectedFloor = getSelectedOption('floor')
                console.log('Floor select event: ' + selectedFloor )
                updateRoomSelector(selectedFloor)
            })
            // User selects a room from dropdown
            $('select#room-selector').change(function() {
                if ($(this).attr('disabled')) {
                    console.log('Invalid change - Room selector changed while disabled')
                }
                selectedFloor = getSelectedOption('floor')
                selectedRoom = getSelectedOption('room')
                console.log('Room select event: ' + selectedRoom)
                updateWallSelector(selectedFloor, selectedRoom)
            })
            // Use clicks get info button
            $('#getInfo').bind('click', function() {
                $('#output').val(
                    "===== Complete Scenario info for \"" + scenario.name +"\" =====\n"
                    + scenario.dispInfo()
                )
            })

            // ##########################
            // ##### UI FUNCTIONS #######
            // ##########################

            // Gets a list of floors from the scenario
            function updateFloorSelector() {
                disableSelector('floor')

                if (!isScenarioDefined) {
                    console.log('updateFloorSelector - scenario not defined')
                    return;
                }

                selector = getSelector('floor')
                // get floors
                var floors = scenario.getFloorList();
                // add floor options to select element
                if (floors.length > 0) {
                    clearSelector('floor');
                    // iterate over floors and add options
                    $.each(floors, function(key, value) {
                        selector.append('<option value=\'' + value.z + '\'>[' + value.z + ']' + value.name + '</option>')
                    })
                    enableSelector('floor')
                    // Get selected floor z and update room selector
                    updateRoomSelector(getSelectedOption('floor'))
                }
            }
            // Gets a list of rooms by floor z value
            function updateRoomSelector(floorZ) {
                disableSelector('room')
                disableSelector('wall')

                if (!isScenarioDefined) {
                    console.log('updateRoomSelector - scenario not defined')
                    return;
                }

                // get rooms
                var floor = scenario.getFloor(floorZ)
                if (typeof floor == 'undefined') {
                    console.log('updateRoomSelector - invalid floor v=' + floorZ)
                    return;
                }
                var rooms = floor.getRoomList()
                if (typeof rooms === 'undefined') {
                    console.log('updateRoomSelector - invalid floor z=' + floorZ);
                    return;
                } else if (rooms.length <= 0) {
                    console.log('updateRoomSelector - no rooms on floor z=' + floorZ)
                    return;
                }

                selector = getSelector('room')
                clearSelector('room');
                $.each(rooms, function(key, value){
                    selector.append('<option value=\'' + value.id + '\'>' + value.name + ' (' + value.x + ',' + value.y + ',' + value.z + ')' +'</option>')
                })
                enableSelector('room');

                updateWallSelector(floorZ, getSelectedOption('room'))
            }

            function updateWallSelector(floorZ, roomId) {
                disableSelector('wall')

                if (!isScenarioDefined) {
                    console.log('updateWallSelector - scenario not defined')
                    return;
                }

                // get room
                var floor = scenario.getFloor(floorZ)
                if (typeof floor === 'undefined') {
                    console.log('updateWallSelector - invalid floor v=' + floorZ)
                    return;
                }
                var room = floor.getRoomById(roomId)
                if (typeof room === 'undefined') {
                    console.log('updateWallSelector - invalid room id=' + roomId)
                    return;
                }
                var walls = room.getWallList()

                selector = getSelector('wall')
                if (walls.length > 0) {
                    clearSelector('wall')
                    $.each(walls, function(key, value) {
                        selector.append('<option value=\'' + value.direction + '\'>' + value.name + " (" + value.direction + ")</option>")
                    })
                    enableSelector('wall')
                }
            }
            function getSelectedOption(name) {
                selector = getSelector(name)
                return selector.find(':selected').attr('value')
            }
            function isScenarioDefined() {
                if (typeof scenario === 'undefined') {
                    console.log('scenario class undefined')
                    return false;
                }
                return true;
            }
            function disableSelector(name) {
                var selector = getSelector(name);
                if (!selector) { 
                    console.log('disableSelector - selector ' + name + ' not found')
                    return;
                }
                if (!selector.attr('disabled')) {
                    selector.attr('disabled', 'disabled')
                    clearSelector(name)
                    selector.append('<option value=\'blank\'>No ' + name + ' Listed</option>')   
                }

            }
            function enableSelector(name) {
                selector = getSelector(name);
                if (!selector) { 
                    console.log('enableSelector - selector' + name + 'not found')
                    return;
                }
                if (selector.attr('disabled')) {
                    selector.removeAttr('disabled')
                }

            }
            function clearSelector(name) {
                selector = getSelector(name)
                if (!selector) { 
                    console.log('clearSelector - selector' + name + 'not found')
                    return;
                }
                selector.empty()
            }
            function getSelector(name) {
                var selector = ""
                if (name == 'floor') {
                    selector = $('select#floor-selector')
                } else if (name == 'room') {
                    selector = $('select#room-selector')
                } else if (name == 'wall') {
                    selector = $('select#wall-selector')
                } else {
                    return null;
                }
                if (typeof selector === 'undefined') { 
                    console.log('selector not found')
                    return null;
                }
                return selector;
            }
        });
    </script>
</body>
</html>